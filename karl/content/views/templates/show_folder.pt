<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal"
     metal:use-macro="layout.macros['master']">

  <span metal:fill-slot="extra-headers" tal:omit-tag=""
        tal:condition="feed_url|None">
    <link rel="alternate" type="application/atom+xml" 
	  title="${api.page_title}" href="${feed_url}"
	  />
    <!-- XXX dependencies for the karl.multifileupload are inserted here for now
         XXX needs to be minified and possibly moved to snippets.pt at some point
    -->
    <!-- Thirdparty intialization scripts, needed for the Google Gears and BrowserPlus runtimes -->
    <script type="text/javascript" src="${api.static_url}/plupload/js/gears_init.js"></script>
    <script type="text/javascript" src="http://bp.yahooapis.com/2.4.21/browserplus-min.js"></script>
    <!-- Load plupload and all it's runtimes and finally the jQuery UI queue widget -->
    <script type="text/javascript" src="${api.static_url}/plupload/js/plupload.full.min.js"></script>
    <script type="text/javascript" src="${api.static_url}/plupload/js/jquery.ui.plupload.min.js"></script>
    <link rel="stylesheet" href="${api.static_url}/plupload/examples/css/jquery.ui.plupload.css" type="text/css"/>
    <!-- additional stuff needed from jquery-ui (currently not in karl js bundle) -->
    <script src="${api.static_url}/jquery-ui/1.8.2/development-bundle/ui/jquery.ui.progressbar.js" type="text/javascript">//</script>
    <link rel="stylesheet" href="${api.static_url}/jquery-ui/1.8.2/development-bundle/themes/base/jquery.ui.progressbar.css" type="text/css"/>
    <script src="${api.static_url}/karl-plugins/karl-multifileupload/json2.js" type="text/javascript">//</script>
    <!-- karl custom code for file upload --> 
    <script src="${api.static_url}/karl-plugins/karl-multifileupload/karl.multifileupload.js" type="text/javascript">//</script>
    <link rel="stylesheet" href="${api.static_url}/karl-plugins/karl-multifileupload/karl.multifileupload.css" type="text/css"/>
    <link rel="stylesheet" href="${api.static_url}/karl-plugins/karl-multifileupload/karl.multifileupload-integration.css" type="text/css"/>
    <script language="javascript" type="text/javascript">
        //<![CDATA[
        var static_url = $("#karl-static-url").eq(0).attr('content');
        var here_url = $("#karl-here-url").eq(0).attr('content');
        $(document).ready(function() {
            // bind the karl.multifileupload widget
            $('.view-show-folder-actions #menubar-3')
                .karlmultifileupload({
                  plupload_src: static_url + '/plupload',
                  upload_url: here_url + '/upload_file.json'
                })
                .click(function() {
                    $(this)
                        .karlmultifileupload('open')
                        .karlmultifileupload('position', {my: 'right top', at: 'right bottom', of: this, collision: 'fit'});
                    return false;
                })
                .bind('refresh.multifileupload', function() {
                    // update the grid
                    $('#filegrid').data('karlgrid')._update({columns: false, refresh: true});
                });
        });
        //]]>
    </script>

  </span>
  
  <div metal:fill-slot="content">

    <div metal:use-macro="api.snippets.macros['status_message']"/>
    <div class="view-show-folder-actions">
      <div metal:use-macro="api.snippets.macros['actions_box']"/>
    </div>

    <div metal:use-macro="api.snippets.macros['backto_link']"/>
  
    <h1 metal:use-macro="api.snippets.macros['page_title']"/>

    <div metal:use-macro="api.snippets.macros['list_tags']"/> 

    <div metal:use-macro="api.snippets.macros['folder_grid']"> </div>

    <div metal:use-macro="api.snippets.macros['rss_icon']"/>

  </div>

</html>
